{"version":3,"sources":["webpack:///src/pages/traffic/bind/bind.vue","webpack:///./src/pages/traffic/bind/bind.vue?d003","webpack:///./src/pages/traffic/bind/bind.vue"],"names":["bind","_this","this","_getCarList","_this2","currentPage","pageSize","queryText","cur_page","page_size","item_counts","list","msg","closeCarBindDialog","_this3","vehicle_number","tbox_id","vehicle_brand","initial_mile","then","res","vehicle_id","ret","value","car_id","brand_logo","clearFiles","_this4","size","page","searchBox","bind_bind","render","_vm","_h","$createElement","_c","_self","staticClass","attrs","addBtn","on","onSearch","onSearchClick","onAdd","onAddClick","_v","title","dialogType","visible","carBindDialog","model","width","update:visible","$event","close","ref","formData","label-width","rules","formRules","label","prop","auto-complete","readonly","callback","$$v","$set","expression","maxlength","class","hiddenUploadBtn","multiple","action","uploadPath","data","name","headers","limit","file-list","logoFile","list-type","accept","before-upload","beforeUpload","on-change","uploadChange","on-remove","uploadRemove","on-success","uploadSuccess","on-error","uploadError","auto-upload","slot","click","type","onSubmitForm","directives","rawName","element-loading-text","staticStyle","tableData","empty-text","emptyText","border","height","formatter","formatMile","scopedSlots","_u","key","fn","scope","row","src","baseApiPath","alt","onEditClick","state","onDeleteClick","_e","current-page","page-sizes","page-size","layout","total","size-change","onSizeChange","current-change","onCurrentChange","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/15.ec154411408b70bee3f6.js","sourcesContent":["<style scoped lang=\"less\">\r\n  @import \"./bind.less\";\r\n</style>\r\n<template>\r\n\t<section class=\"bind main-panel\">\r\n    <searchBox :addBtn=\"true\" @onSearch=\"onSearchClick\" @onAdd=\"onAddClick\"></searchBox>\r\n    <el-dialog :title=\"dialogType === 1 ? '新增车辆绑定':'编辑车辆绑定'\" :visible.sync=\"carBindDialog\" model=\"right\" width=\"40%\" @close=\"closeCarBindDialog\">\r\n      <el-form :model=\"formData\" label-width=\"100px\" :rules=\"formRules\" ref=\"carBindForm\">\r\n        <el-form-item label=\"车牌号\" prop=\"vehicle_number\">\r\n          <el-input v-model=\"formData.vehicle_number\" auto-complete=\"off\" :readonly=\"dialogType===1? false:true\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"序列号\" prop=\"tbox_id\">\r\n          <el-input v-model=\"formData.tbox_id\" auto-complete=\"off\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"车辆品牌\" prop=\"vehicle_brand\">\r\n          <el-input v-model=\"formData.vehicle_brand\" auto-complete=\"off\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"初始公里数\" prop=\"initial_mile\">\r\n          <el-input v-model=\"formData.initial_mile\" auto-complete=\"off\" :maxlength=\"6\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"品牌logo\" prop=\"logoFile\">\r\n          <el-upload\r\n            ref=\"upload\"\r\n            :multiple=\"false\"\r\n            :action=\"uploadPath\"\r\n            :data=\"formData\"\r\n            name=\"logo_file\"\r\n            :headers=\"headers\"\r\n            :limit=\"1\"\r\n            :class=\"{hiddenUploadBtn: hiddenUploadBtn}\"\r\n            :file-list=\"formData.logoFile\"\r\n            list-type=\"picture-card\"\r\n            accept=\".jpg, .png\"\r\n            :before-upload=\"beforeUpload\"\r\n            :on-change=\"uploadChange\"\r\n            :on-remove=\"uploadRemove\"\r\n            :on-success=\"uploadSuccess\"\r\n            :on-error=\"uploadError\"\r\n            :auto-upload=\"false\">\r\n            <i class=\"el-icon-plus\"></i>\r\n            <div slot=\"tip\">每次只能上传一张jpg/png格式的图片，且不超过500kb</div>\r\n          </el-upload>\r\n        </el-form-item>\r\n      </el-form>\r\n      <div slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"carBindDialog=false\">取 消</el-button>\r\n        <el-button type=\"primary\" @click=\"onSubmitForm\">保 存</el-button>\r\n      </div>\r\n    </el-dialog>\r\n    <div v-loading=\"loading\" element-loading-text=\"数据加载中...\">\r\n      <el-table\r\n        :data=\"tableData\"\r\n        :empty-text=\"emptyText\"\r\n        border\r\n        height=\"532\"\r\n        style=\"width: 100%\">\r\n        <el-table-column\r\n          prop=\"vehicle_number\"\r\n          label=\"车牌\"\r\n          width=\"200\">\r\n        </el-table-column>\r\n        <el-table-column\r\n          prop=\"tbox_id\"\r\n          label=\"设备序列号\"\r\n          width=\"300\">\r\n        </el-table-column>\r\n        <el-table-column\r\n          prop=\"initial_mile\"\r\n          :formatter=\"formatMile\"\r\n          label=\"初始里程\">\r\n        </el-table-column>\r\n        <el-table-column\r\n          prop=\"vehicle_brand\"\r\n          label=\"车辆品牌\">\r\n        </el-table-column>\r\n        <el-table-column\r\n          prop=\"brand_logo\"\r\n          label=\"品牌logo\">\r\n          <template slot-scope=\"scope\">\r\n            <img :src=\"baseApiPath+scope.row.brand_logo\" alt=\"汽车品牌\" class=\"brand-img\" v-if=\"scope.row.brand_logo\">\r\n            <span v-else>暂无图片</span>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column\r\n          prop=\"op_update_time\"\r\n          label=\"更新时间\">\r\n        </el-table-column>\r\n        <el-table-column\r\n          width=\"160\"\r\n          label=\"操作\">\r\n          <template slot-scope=\"scope\">\r\n            <el-button @click=\"onEditClick(scope.row)\" type=\"text\" size=\"small\">编辑</el-button>\r\n            <el-button @click=\"onDeleteClick(scope.row)\" v-if=\"scope.row.state === 1\" type=\"text\" size=\"small\">删除</el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n    </div>\r\n    <el-pagination\r\n      @size-change=\"onSizeChange\"\r\n      @current-change=\"onCurrentChange\"\r\n      :current-page=\"currentPage\"\r\n      :page-sizes=\"[10, 20, 30, 40]\"\r\n      :page-size=\"pageSize\"\r\n      layout=\"total, sizes, prev, pager, next, jumper\"\r\n      :total=\"total\">\r\n    </el-pagination>\r\n\t</section>\r\n</template>\r\n\r\n<script>\r\nimport {getCarList} from '@/api/drive'\r\nimport {addBindCar, updateBindCar, deleteBindCar} from '@/api/traffic'\r\nimport validator from '@/common/js/validator'\r\nimport searchBox from '@/components/search-box'\r\nexport default {\r\n  name: 'bind',\r\n  data () {\r\n    return {\r\n\t    tableData: [], \r\n      currentPage: 1, // 当前页\r\n      pageSize: 10, // 每页大小\r\n      total: 0, // 总记录数\r\n      pageFlag: false, // 防止分页快速点击bug\r\n      loading: false,\r\n      emptyText: ' ',\r\n      carBindDialog: false,\r\n      dialogType: 1,\r\n      queryText: '', // 搜索车牌号\r\n      formData: {\r\n        vehicle_id: '',\r\n        vehicle_number: '',\r\n        tbox_id: '',\r\n        vehicle_brand: '',\r\n        initial_mile: '',\r\n        logoFile: [] // {name:'',url:''}\r\n      },\r\n      formRules:{\r\n        vehicle_number: [{ required: true, message: '请输入车牌号', trigger: 'blur' }, { validator: validator.checkCarNumber, trigger: 'blur' }],\r\n        tbox_id: [{ required: true, message: '请输入车载盒子序列号', trigger: 'blur' }],\r\n        vehicle_brand: [{ required: true, message: '请输入车辆品牌', trigger: 'blur' }],\r\n        initial_mile: [{ required: true, message: '请输入初始公里数', trigger: 'blur' }, { validator: validator.checkOriginMile, trigger: 'blur' }]\r\n        // logoFile: [{ required: true, message: '请选择图片', trigger: 'change' }]\r\n      },\r\n      headers: {Authorization: window.sessionStorage.getItem('token')},\r\n      hasFile: false, // 判断是否有文件 \r\n      // 从webpack配置自动获取到当前环境\r\n      // let baseUrl = process.env.BASE_API\r\n      baseApiPath: `${process.env.BASE_API}/`,\r\n      uploadPath: `${process.env.BASE_API}/car/add`, // 图片上传路径\r\n      // uploadForm: new FormData(),\r\n      hiddenUploadBtn: false // 是否隐藏上传按钮\r\n    }\r\n  },\r\n  mounted() {\r\n    this.$nextTick(()=>{\r\n      this._getCarList()\r\n    })\r\n  },\r\n  methods:{\r\n    _getCarList(){\r\n      let params = {\r\n        page: this.currentPage, \r\n        page_size: this.pageSize,\r\n        vehicle_number: this.queryText\r\n      }\r\n      this.loading = true\r\n      getCarList(params).then((res) => {\r\n        this.pageFlag = false\r\n        if(res.data.ret == 0){\r\n          this.currentPage = res.data.datas.cur_page\r\n          this.pageSize = res.data.datas.page_size\r\n          this.total = res.data.datas.item_counts\r\n          this.tableData = [...res.data.datas.list]\r\n        }else{\r\n          this.$message({\r\n            message: res.data.msg,\r\n            type: 'error'\r\n          })\r\n        }\r\n        this.loading = false // 关闭加载动画\r\n        if(!this.tableData.length) this.emptyText = '暂无数据'\r\n      })\r\n    },\r\n    beforeUpload(file){\r\n      // this.uploadForm.append('logo_file', file)\r\n      // this.uploadForm.append('vehicle_number', this.formData.vehicle_number)\r\n      // this.uploadForm.append('tbox_id', this.formData.tbox_id)\r\n      // this.uploadForm.append('vehicle_brand', this.formData.vehicle_brand)\r\n      // addBindCar(this.uploadForm).then((res)=>{\r\n      //   console.log(res)\r\n      // })\r\n      return true\r\n    },\r\n    uploadChange(file, fileList){\r\n      // console.log(fileList)\r\n      if(fileList.length){\r\n        this.hasFile = true\r\n        this.hiddenUploadBtn = true\r\n      }\r\n    },\r\n    uploadRemove(file, fileList){\r\n      // console.log(file)\r\n      if(file.name){\r\n        this.hiddenUploadBtn = false\r\n      }\r\n    },\r\n    uploadSuccess(response, file, fileList){\r\n      this.dialogType === 1 ? this.loadTableData(response, 1, true) : this.loadTableData(response, 2, true) \r\n      this.closeCarBindDialog()\r\n    },\r\n    uploadError(err, file, fileList){\r\n      this.$message({\r\n        message: err.data.msg,\r\n        type: 'error'\r\n      })\r\n    },\r\n    onSubmitForm(){\r\n      // console.log(this.formData.logoFile)\r\n      this.$refs['carBindForm'].validate((valid) => {\r\n        if (valid) {\r\n          if(!this.hasFile){\r\n            if(this.dialogType === 1){\r\n              addBindCar({\r\n                'vehicle_number': this.formData.vehicle_number,\r\n                'tbox_id': this.formData.tbox_id,\r\n                'vehicle_brand': this.formData.vehicle_brand,\r\n                'initial_mile': this.formData.initial_mile\r\n              }).then((res)=>{\r\n                this.loadTableData(res, 1, false)\r\n                this.closeCarBindDialog()\r\n              })\r\n            }else{\r\n              updateBindCar({\r\n                'vehicle_id': this.formData.vehicle_id,\r\n                'vehicle_number': this.formData.vehicle_number,\r\n                'tbox_id': this.formData.tbox_id,\r\n                'vehicle_brand': this.formData.vehicle_brand,\r\n                'initial_mile': this.formData.initial_mile\r\n              }).then((res)=>{\r\n                this.loadTableData(res, 2, false)\r\n                this.closeCarBindDialog()\r\n              })\r\n            }\r\n          }else{\r\n            this.$refs.upload.submit() // 有图片则上传图片与参数\r\n          }\r\n        } else {\r\n          console.log('error submit!!')\r\n          return false;\r\n        }\r\n      })\r\n    },\r\n    // 重新加载数据 type为1则是新增状态，2为编辑状态，3为删除状态\r\n    // 因element图片上传无法使用axios，而axios是对响应多封装了一层data，故处理结果不同 \r\n    loadTableData(res, status, isUpload){\r\n      // console.log(res)\r\n      let code = isUpload ? res.ret : res.data.ret\r\n      if(code == 0){\r\n        this.carBindDialog = false\r\n        this._getCarList({ page: this.currentPage, page_size: this.pageSize, vehicle_number: this.queryText})\r\n        let msg = status === 1 ? '新增成功！' : status === 2 ? '修改成功！' : '删除成功！'\r\n        this.$message({\r\n          message: msg,\r\n          type: 'success'\r\n        })\r\n      }else{\r\n        this.$message({\r\n          message: res.msg,\r\n          type: 'error'\r\n        })\r\n      }\r\n    },\r\n    // 添加\r\n    onAddClick(){\r\n      this.dialogType = 1\r\n      this.carBindDialog = true\r\n      this.hiddenUploadBtn = false // 打开图片添加按钮\r\n      this.uploadPath= `${this.baseApiPath}car/add` // 新增图片路径\r\n    },\r\n    // 搜索\r\n    onSearchClick(value){\r\n      this.queryText = value\r\n      if(this.currentPage === 1 ){\r\n        this._getCarList()\r\n      }else{\r\n        // 通过改变页数来触发事件从而进行搜索\r\n        this.currentPage = 1\r\n      }\r\n    },\r\n    // 编辑\r\n    onEditClick(row){\r\n      // console.log(row)\r\n      this.formData.vehicle_id = row.car_id\r\n      this.formData.vehicle_number = row.vehicle_number\r\n      this.formData.tbox_id = row.tbox_id\r\n      this.formData.vehicle_brand = row.vehicle_brand\r\n      this.formData.initial_mile = parseInt(row.initial_mile/1000)\r\n      if(row.brand_logo){\r\n        this.formData.logoFile = [{name:'edit', url:`${this.baseApiPath}${row.brand_logo}`}]\r\n        this.hiddenUploadBtn = true // 关闭图片添加按钮\r\n      }else{\r\n        this.formData.logoFile = []\r\n        this.hiddenUploadBtn = false // 打开图片添加按钮\r\n      }\r\n      this.dialogType = 2\r\n      this.carBindDialog = true\r\n      this.uploadPath= `${this.baseApiPath}car/update` // 更新图片路径\r\n    },\r\n    // 窗口关闭重置窗口\r\n    closeCarBindDialog(){\r\n      this.$refs['carBindForm'].resetFields() // 重置表单移除校验结果\r\n      this.$refs.upload.clearFiles()\r\n      this.hasFile = false // 重置有无图片状态\r\n      this.formData.vehicle_id = null\r\n      this.formData.vehicle_number = ''\r\n      this.formData.tbox_id = ''\r\n      this.formData.vehicle_brand = ''\r\n      this.formData.initial_mile = ''\r\n      this.formData.logoFile = []\r\n    },\r\n    onDeleteClick(row){\r\n      this.$confirm('此操作将永久删除该行, 是否继续?', '提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      }).then(() => {\r\n        deleteBindCar({vehicle_id: row.car_id}).then((res)=>{\r\n          this.loadTableData(res, 3, false)\r\n        })\r\n      })\r\n    },\r\n    // 分页每页显示大小变化事件\r\n    onSizeChange(size){ \r\n      this.pageSize = size \r\n      this._getCarList()\r\n    },\r\n    // 当前页数变化事件\r\n    onCurrentChange(page){\r\n      if(!this.pageFlag){\r\n        this.pageFlag = true\r\n        this.currentPage = page\r\n        this._getCarList()\r\n      }\r\n    },\r\n    formatMile(row, column, cellValue){\r\n      return Number(cellValue/1000)\r\n    }\r\n    // 格式化时间\r\n    // formatTime(row, column, cellValue){\r\n    //   return moment.unix(cellValue/1000).format('YYYY-MM-DD HH:mm:ss')\r\n    // }\r\n  },\r\n  components:{\r\n    searchBox\r\n  }\r\n}\r\n</script>\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// src/pages/traffic/bind/bind.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('section',{staticClass:\"bind main-panel\"},[_c('searchBox',{attrs:{\"addBtn\":true},on:{\"onSearch\":_vm.onSearchClick,\"onAdd\":_vm.onAddClick}}),_vm._v(\" \"),_c('el-dialog',{attrs:{\"title\":_vm.dialogType === 1 ? '新增车辆绑定':'编辑车辆绑定',\"visible\":_vm.carBindDialog,\"model\":\"right\",\"width\":\"40%\"},on:{\"update:visible\":function($event){_vm.carBindDialog=$event},\"close\":_vm.closeCarBindDialog}},[_c('el-form',{ref:\"carBindForm\",attrs:{\"model\":_vm.formData,\"label-width\":\"100px\",\"rules\":_vm.formRules}},[_c('el-form-item',{attrs:{\"label\":\"车牌号\",\"prop\":\"vehicle_number\"}},[_c('el-input',{attrs:{\"auto-complete\":\"off\",\"readonly\":_vm.dialogType===1? false:true},model:{value:(_vm.formData.vehicle_number),callback:function ($$v) {_vm.$set(_vm.formData, \"vehicle_number\", $$v)},expression:\"formData.vehicle_number\"}})],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"序列号\",\"prop\":\"tbox_id\"}},[_c('el-input',{attrs:{\"auto-complete\":\"off\"},model:{value:(_vm.formData.tbox_id),callback:function ($$v) {_vm.$set(_vm.formData, \"tbox_id\", $$v)},expression:\"formData.tbox_id\"}})],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"车辆品牌\",\"prop\":\"vehicle_brand\"}},[_c('el-input',{attrs:{\"auto-complete\":\"off\"},model:{value:(_vm.formData.vehicle_brand),callback:function ($$v) {_vm.$set(_vm.formData, \"vehicle_brand\", $$v)},expression:\"formData.vehicle_brand\"}})],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"初始公里数\",\"prop\":\"initial_mile\"}},[_c('el-input',{attrs:{\"auto-complete\":\"off\",\"maxlength\":6},model:{value:(_vm.formData.initial_mile),callback:function ($$v) {_vm.$set(_vm.formData, \"initial_mile\", $$v)},expression:\"formData.initial_mile\"}})],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"品牌logo\",\"prop\":\"logoFile\"}},[_c('el-upload',{ref:\"upload\",class:{hiddenUploadBtn: _vm.hiddenUploadBtn},attrs:{\"multiple\":false,\"action\":_vm.uploadPath,\"data\":_vm.formData,\"name\":\"logo_file\",\"headers\":_vm.headers,\"limit\":1,\"file-list\":_vm.formData.logoFile,\"list-type\":\"picture-card\",\"accept\":\".jpg, .png\",\"before-upload\":_vm.beforeUpload,\"on-change\":_vm.uploadChange,\"on-remove\":_vm.uploadRemove,\"on-success\":_vm.uploadSuccess,\"on-error\":_vm.uploadError,\"auto-upload\":false}},[_c('i',{staticClass:\"el-icon-plus\"}),_vm._v(\" \"),_c('div',{attrs:{\"slot\":\"tip\"},slot:\"tip\"},[_vm._v(\"每次只能上传一张jpg/png格式的图片，且不超过500kb\")])])],1)],1),_vm._v(\" \"),_c('div',{staticClass:\"dialog-footer\",attrs:{\"slot\":\"footer\"},slot:\"footer\"},[_c('el-button',{on:{\"click\":function($event){_vm.carBindDialog=false}}},[_vm._v(\"取 消\")]),_vm._v(\" \"),_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":_vm.onSubmitForm}},[_vm._v(\"保 存\")])],1)],1),_vm._v(\" \"),_c('div',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.loading),expression:\"loading\"}],attrs:{\"element-loading-text\":\"数据加载中...\"}},[_c('el-table',{staticStyle:{\"width\":\"100%\"},attrs:{\"data\":_vm.tableData,\"empty-text\":_vm.emptyText,\"border\":\"\",\"height\":\"532\"}},[_c('el-table-column',{attrs:{\"prop\":\"vehicle_number\",\"label\":\"车牌\",\"width\":\"200\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"prop\":\"tbox_id\",\"label\":\"设备序列号\",\"width\":\"300\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"prop\":\"initial_mile\",\"formatter\":_vm.formatMile,\"label\":\"初始里程\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"prop\":\"vehicle_brand\",\"label\":\"车辆品牌\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"prop\":\"brand_logo\",\"label\":\"品牌logo\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [(scope.row.brand_logo)?_c('img',{staticClass:\"brand-img\",attrs:{\"src\":_vm.baseApiPath+scope.row.brand_logo,\"alt\":\"汽车品牌\"}}):_c('span',[_vm._v(\"暂无图片\")])]}}])}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"prop\":\"op_update_time\",\"label\":\"更新时间\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"width\":\"160\",\"label\":\"操作\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_c('el-button',{attrs:{\"type\":\"text\",\"size\":\"small\"},on:{\"click\":function($event){_vm.onEditClick(scope.row)}}},[_vm._v(\"编辑\")]),_vm._v(\" \"),(scope.row.state === 1)?_c('el-button',{attrs:{\"type\":\"text\",\"size\":\"small\"},on:{\"click\":function($event){_vm.onDeleteClick(scope.row)}}},[_vm._v(\"删除\")]):_vm._e()]}}])})],1)],1),_vm._v(\" \"),_c('el-pagination',{attrs:{\"current-page\":_vm.currentPage,\"page-sizes\":[10, 20, 30, 40],\"page-size\":_vm.pageSize,\"layout\":\"total, sizes, prev, pager, next, jumper\",\"total\":_vm.total},on:{\"size-change\":_vm.onSizeChange,\"current-change\":_vm.onCurrentChange}})],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/_vue-loader@13.7.1@vue-loader/lib/template-compiler?{\"id\":\"data-v-76861c67\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/_vue-loader@13.7.1@vue-loader/lib/selector.js?type=template&index=0!./src/pages/traffic/bind/bind.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../../node_modules/_extract-text-webpack-plugin@3.0.2@extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../../node_modules/_vue-loader@13.7.1@vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-76861c67\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!less-loader?{\\\"sourceMap\\\":true}!../../../../node_modules/_vue-loader@13.7.1@vue-loader/lib/selector?type=styles&index=0!./bind.vue\")\n}\nvar normalizeComponent = require(\"!../../../../node_modules/_vue-loader@13.7.1@vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../../node_modules/_vue-loader@13.7.1@vue-loader/lib/selector?type=script&index=0!./bind.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../../node_modules/_vue-loader@13.7.1@vue-loader/lib/selector?type=script&index=0!./bind.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../../node_modules/_vue-loader@13.7.1@vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-76861c67\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../../node_modules/_vue-loader@13.7.1@vue-loader/lib/selector?type=template&index=0!./bind.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-76861c67\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pages/traffic/bind/bind.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}