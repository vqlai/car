webpackJsonp([15],{"8ogx":function(e,t){},g84n:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("IHPB"),o=a.n(i),l=a("865i"),r=a("8RsO"),n=a("3Ri9"),s={name:"bind",data:function(){return{tableData:[],currentPage:1,pageSize:10,total:0,pageFlag:!1,loading:!1,emptyText:" ",carBindDialog:!1,dialogType:1,queryText:"",formData:{vehicle_id:"",vehicle_number:"",tbox_id:"",vehicle_brand:"",initial_mile:"",logoFile:[]},formRules:{vehicle_number:[{required:!0,message:"请输入车牌号",trigger:"blur"},{validator:n.a.checkCarNumber,trigger:"blur"}],tbox_id:[{required:!0,message:"请输入车载盒子序列号",trigger:"blur"}],vehicle_brand:[{required:!0,message:"请输入车辆品牌",trigger:"blur"}],initial_mile:[{required:!0,message:"请输入初始公里数",trigger:"blur"},{validator:n.a.checkOriginMile,trigger:"blur"}]},headers:{Authorization:window.sessionStorage.getItem("token")},hasFile:!1,baseApiPath:"//iotsvr.he-live.com:8002/",uploadPath:"//iotsvr.he-live.com:8002/car/add",hiddenUploadBtn:!1}},mounted:function(){var e=this;this.$nextTick(function(){e._getCarList()})},methods:{_getCarList:function(){var e=this,t={page:this.currentPage,page_size:this.pageSize,vehicle_number:this.queryText};this.loading=!0,Object(l.d)(t).then(function(t){e.pageFlag=!1,0==t.data.ret?(e.currentPage=t.data.datas.cur_page,e.pageSize=t.data.datas.page_size,e.total=t.data.datas.item_counts,e.tableData=[].concat(o()(t.data.datas.list))):e.$message({message:t.data.msg,type:"error"}),e.loading=!1,e.tableData.length||(e.emptyText="暂无数据")})},beforeUpload:function(e){return!0},uploadChange:function(e,t){t.length&&(this.hasFile=!0,this.hiddenUploadBtn=!0)},uploadRemove:function(e,t){e.name&&(this.hiddenUploadBtn=!1)},uploadSuccess:function(e,t,a){1===this.dialogType?this.loadTableData(e,1,!0):this.loadTableData(e,2,!0),this.closeCarBindDialog()},uploadError:function(e,t,a){this.$message({message:e.data.msg,type:"error"})},onSubmitForm:function(){var e=this;this.$refs.carBindForm.validate(function(t){if(!t)return console.log("error submit!!"),!1;e.hasFile?e.$refs.upload.submit():1===e.dialogType?Object(r.a)({vehicle_number:e.formData.vehicle_number,tbox_id:e.formData.tbox_id,vehicle_brand:e.formData.vehicle_brand,initial_mile:e.formData.initial_mile}).then(function(t){e.loadTableData(t,1,!1),e.closeCarBindDialog()}):Object(r.s)({vehicle_id:e.formData.vehicle_id,vehicle_number:e.formData.vehicle_number,tbox_id:e.formData.tbox_id,vehicle_brand:e.formData.vehicle_brand,initial_mile:e.formData.initial_mile}).then(function(t){e.loadTableData(t,2,!1),e.closeCarBindDialog()})})},loadTableData:function(e,t,a){if(0==(a?e.ret:e.data.ret)){this.carBindDialog=!1,this._getCarList({page:this.currentPage,page_size:this.pageSize,vehicle_number:this.queryText});var i=1===t?"新增成功！":2===t?"修改成功！":"删除成功！";this.$message({message:i,type:"success"})}else this.$message({message:e.msg,type:"error"})},onAddClick:function(){this.dialogType=1,this.carBindDialog=!0,this.hiddenUploadBtn=!1,this.uploadPath=this.baseApiPath+"car/add"},onSearchClick:function(e){this.queryText=e,1===this.currentPage?this._getCarList():this.currentPage=1},onEditClick:function(e){this.formData.vehicle_id=e.car_id,this.formData.vehicle_number=e.vehicle_number,this.formData.tbox_id=e.tbox_id,this.formData.vehicle_brand=e.vehicle_brand,this.formData.initial_mile=parseInt(e.initial_mile/1e3),e.brand_logo?(this.formData.logoFile=[{name:"edit",url:""+this.baseApiPath+e.brand_logo}],this.hiddenUploadBtn=!0):(this.formData.logoFile=[],this.hiddenUploadBtn=!1),this.dialogType=2,this.carBindDialog=!0,this.uploadPath=this.baseApiPath+"car/update"},closeCarBindDialog:function(){this.$refs.carBindForm.resetFields(),this.$refs.upload.clearFiles(),this.hasFile=!1,this.formData.vehicle_id=null,this.formData.vehicle_number="",this.formData.tbox_id="",this.formData.vehicle_brand="",this.formData.initial_mile="",this.formData.logoFile=[]},onDeleteClick:function(e){var t=this;this.$confirm("此操作将永久删除该行, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(r.g)({vehicle_id:e.car_id}).then(function(e){t.loadTableData(e,3,!1)})})},onSizeChange:function(e){this.pageSize=e,this._getCarList()},onCurrentChange:function(e){this.pageFlag||(this.pageFlag=!0,this.currentPage=e,this._getCarList())},formatMile:function(e,t,a){return Number(a/1e3)}},components:{searchBox:a("Rv3D").a}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"bind main-panel"},[a("searchBox",{attrs:{addBtn:!0},on:{onSearch:e.onSearchClick,onAdd:e.onAddClick}}),e._v(" "),a("el-dialog",{attrs:{title:1===e.dialogType?"新增车辆绑定":"编辑车辆绑定",visible:e.carBindDialog,model:"right",width:"40%"},on:{"update:visible":function(t){e.carBindDialog=t},close:e.closeCarBindDialog}},[a("el-form",{ref:"carBindForm",attrs:{model:e.formData,"label-width":"100px",rules:e.formRules}},[a("el-form-item",{attrs:{label:"车牌号",prop:"vehicle_number"}},[a("el-input",{attrs:{"auto-complete":"off",readonly:1!==e.dialogType},model:{value:e.formData.vehicle_number,callback:function(t){e.$set(e.formData,"vehicle_number",t)},expression:"formData.vehicle_number"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"序列号",prop:"tbox_id"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.formData.tbox_id,callback:function(t){e.$set(e.formData,"tbox_id",t)},expression:"formData.tbox_id"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"车辆品牌",prop:"vehicle_brand"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.formData.vehicle_brand,callback:function(t){e.$set(e.formData,"vehicle_brand",t)},expression:"formData.vehicle_brand"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"初始公里数",prop:"initial_mile"}},[a("el-input",{attrs:{"auto-complete":"off",maxlength:6},model:{value:e.formData.initial_mile,callback:function(t){e.$set(e.formData,"initial_mile",t)},expression:"formData.initial_mile"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"品牌logo",prop:"logoFile"}},[a("el-upload",{ref:"upload",class:{hiddenUploadBtn:e.hiddenUploadBtn},attrs:{multiple:!1,action:e.uploadPath,data:e.formData,name:"logo_file",headers:e.headers,limit:1,"file-list":e.formData.logoFile,"list-type":"picture-card",accept:".jpg, .png","before-upload":e.beforeUpload,"on-change":e.uploadChange,"on-remove":e.uploadRemove,"on-success":e.uploadSuccess,"on-error":e.uploadError,"auto-upload":!1}},[a("i",{staticClass:"el-icon-plus"}),e._v(" "),a("div",{attrs:{slot:"tip"},slot:"tip"},[e._v("每次只能上传一张jpg/png格式的图片，且不超过500kb")])])],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.carBindDialog=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.onSubmitForm}},[e._v("保 存")])],1)],1),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"element-loading-text":"数据加载中..."}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,"empty-text":e.emptyText,border:"",height:"532"}},[a("el-table-column",{attrs:{prop:"vehicle_number",label:"车牌",width:"200"}}),e._v(" "),a("el-table-column",{attrs:{prop:"tbox_id",label:"设备序列号",width:"300"}}),e._v(" "),a("el-table-column",{attrs:{prop:"initial_mile",formatter:e.formatMile,label:"初始里程"}}),e._v(" "),a("el-table-column",{attrs:{prop:"vehicle_brand",label:"车辆品牌"}}),e._v(" "),a("el-table-column",{attrs:{prop:"brand_logo",label:"品牌logo"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.brand_logo?a("img",{staticClass:"brand-img",attrs:{src:e.baseApiPath+t.row.brand_logo,alt:"汽车品牌"}}):a("span",[e._v("暂无图片")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"op_update_time",label:"更新时间"}}),e._v(" "),a("el-table-column",{attrs:{width:"160",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){e.onEditClick(t.row)}}},[e._v("编辑")]),e._v(" "),1===t.row.state?a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){e.onDeleteClick(t.row)}}},[e._v("删除")]):e._e()]}}])})],1)],1),e._v(" "),a("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,20,30,40],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.onSizeChange,"current-change":e.onCurrentChange}})],1)},staticRenderFns:[]};var d=a("Z0/y")(s,c,!1,function(e){a("8ogx")},"data-v-76861c67",null);t.default=d.exports}});
//# sourceMappingURL=15.ec154411408b70bee3f6.js.map