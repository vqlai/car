{"version":3,"sources":["webpack:///./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/json/stringify.js","webpack:///./node_modules/_core-js@2.5.3@core-js/library/fn/json/stringify.js","webpack:///src/pages/operation/control/control.vue","webpack:///./src/pages/operation/control/control.vue?519b","webpack:///./src/pages/operation/control/control.vue"],"names":["module","exports","default","__webpack_require__","__esModule","core","$JSON","JSON","stringify","it","apply","arguments","control","label","type","item","_this","this","socket","body","_res$data","res","data","carNumber","userid","_this2","_res$data2","vehicle_number","carTable","car_table","control_control","render","_vm","_h","$createElement","_c","_self","staticClass","directives","name","rawName","value","expression","attrs","element-loading-text","loadingText","element-loading-background","class","on","carData","left_f_lock","_v","right_f_lock","_e","left_b_lock","right_b_lock","_l","click","$event","onBtnClick","_s","width","onCarTableCellClick","staticRenderFns","Component","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"gEAAAA,EAAAC,SAAkBC,QAAAC,EAAA,QAAAC,YAAA,2BCAlB,IAAAC,EAAAF,EAAA,QACAG,EAAAD,EAAAE,OAAAF,EAAAE,MAAuCC,UAAAD,KAAAC,YACvCR,EAAAC,QAAA,SAAAQ,GACA,OAAAH,EAAAE,UAAAE,MAAAJ,EAAAK,iJCmCAC,QAEA,oDAIA,0CAGA,eACA,gBACA,eACA,gBAEA,UACAC,MAAA,KAAAC,KACA,IAAAD,MAAA,KAAAC,KACA,IAAAD,MAAA,KAAAC,KACA,IAAAD,MAAA,KAAAC,KACA,oBAIA,gBACA,eACA,cACA,iBACA,kBAEA,+CAIA,oJAeA,QACA,uBAGAC,2BAbA,qBAEA,WACA,0BAaA,IAAAC,EAAAC,qCACA,gCACAJ,MAAA,qBACA,kCAEA,kDAEA,wFAGAK,uIAIAC,oIAgBA,IAAAC,EAAAC,EACAC,uPAWA,kBACA,2CAIA,kBACA,gCAGA,+EAKAC,qBACAT,aAEAU,+CAKA,IAAAC,EAAAR,sCAGA,kEACA,IAAAS,EAAAL,EACAC,4DAEAK,+QAOA,gDAMA,sBAEA,wBAMAC,SAAAC,EAAA,ICtLAC,GADiBC,OAFjB,WAA0B,IAAAC,EAAAf,KAAagB,EAAAD,EAAAE,eAA0BC,EAAAH,EAAAI,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,WAAqBE,YAAA,YAAsBF,EAAA,gBAAAA,EAAA,WAAmCG,aAAaC,KAAA,UAAAC,QAAA,YAAAC,MAAAT,EAAA,QAAAU,WAAA,YAA4EC,OAASC,uBAAAZ,EAAAa,YAAAC,6BAAA,8BAAgGX,EAAA,OAAYE,YAAA,YAAsBF,EAAA,OAAYE,YAAA,QAAkBL,EAAA,cAAAG,EAAA,OAAgCE,YAAA,sBAAgCF,EAAA,OAAYY,OAAA,QAAeC,GAAAhB,EAAAiB,QAAAC,gBAA6BlB,EAAAmB,GAAA,KAAAhB,EAAA,OAAwBY,OAAA,SAAgBC,GAAAhB,EAAAiB,QAAAG,mBAA8BpB,EAAAqB,KAAArB,EAAAmB,GAAA,KAAAnB,EAAA,cAAAG,EAAA,OAAuDE,YAAA,yBAAmCF,EAAA,OAAYY,OAAA,QAAeC,GAAAhB,EAAAiB,QAAAK,gBAA8BtB,EAAAmB,GAAA,KAAAhB,EAAA,OAAwBY,OAAA,SAAgBC,GAAAhB,EAAAiB,QAAAM,mBAA+BvB,EAAAqB,KAAArB,EAAAmB,GAAA,KAAAnB,EAAA,eAAAG,EAAA,OAAwDY,OAAA,iBAAsBf,EAAAqB,SAAArB,EAAAmB,GAAA,KAAAhB,EAAA,KAAAH,EAAAwB,GAAAxB,EAAA,cAAAjB,GAAoE,OAAAoB,EAAA,MAAgBa,IAAIS,MAAA,SAAAC,GAAyB1B,EAAA2B,WAAA5C,OAAuBiB,EAAAmB,GAAAnB,EAAA4B,GAAA7C,EAAAF,eAA+BmB,EAAAmB,GAAA,KAAAhB,EAAA,YAAgCQ,OAAOkB,MAAA,WAAiB1B,EAAA,WAAgBQ,OAAO7B,KAAA,iBAAsBqB,EAAA,eAAoBQ,OAAO9B,MAAA,UAAgBsB,EAAA,YAAiBa,IAAIc,oBAAA9B,EAAA8B,wBAA+C,oBAEzvCC,oBCCjB,IAcAC,EAdA7D,EAAA,OAcA8D,CACArD,EACAkB,GATA,EAVA,SAAAoC,GACA/D,EAAA,SAaA,kBAEA,MAUAgE,EAAA,QAAAH,EAAA","file":"static/js/6.a04053713ea7347c1c2b.js","sourcesContent":["module.exports = { \"default\": require(\"core-js/library/fn/json/stringify\"), __esModule: true };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/json/stringify.js\n// module id = 3cXf\n// module chunks = 6 7","var core = require('../../modules/_core');\nvar $JSON = core.JSON || (core.JSON = { stringify: JSON.stringify });\nmodule.exports = function stringify(it) { // eslint-disable-line no-unused-vars\n  return $JSON.stringify.apply($JSON, arguments);\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/_core-js@2.5.3@core-js/library/fn/json/stringify.js\n// module id = 4rP4\n// module chunks = 6 7","<style scoped lang=\"less\">\r\n  @import \"./control.less\";\r\n</style>\r\n<template>\r\n\t<section class=\"control\">\r\n    <el-container>\r\n      <el-main v-loading=\"loading\" :element-loading-text=\"loadingText\" element-loading-background=\"rgba(255, 255, 255, 0.7)\">\r\n        <div class=\"car-box\">\r\n          <div class=\"car\">\r\n            <div class=\"lock-top clearfix\" v-if=\"showLockState\">\r\n              <div :class=\"['left',{on:carData.left_f_lock}]\"></div>\r\n              <div :class=\"['right',{on:carData.right_f_lock}]\"></div>\r\n            </div>\r\n            <div class=\"lock-bottom clearfix\" v-if=\"showLockState\">\r\n              <div :class=\"['left',{on: carData.left_b_lock}]\"></div>\r\n              <div :class=\"['right',{on: carData.right_b_lock}]\"></div>\r\n            </div>\r\n            <div :class=\"['center','on']\"  v-if=\"showVoiceState\"></div>\r\n          </div>  \r\n        </div>\r\n        <ul>\r\n          <li v-for=\"item in btns\" @click=\"onBtnClick(item)\">{{item.label}}</li>\r\n        </ul>\r\n      </el-main>\r\n      <el-aside width=\"320px\">\r\n        <el-tabs type=\"border-card\">\r\n          <el-tab-pane label=\"车辆列表\">\r\n            <carTable @onCarTableCellClick=\"onCarTableCellClick\"></carTable>\r\n          </el-tab-pane>\r\n        </el-tabs>\r\n      </el-aside>\r\n    </el-container>\r\n\t</section>\r\n</template>\r\n\r\n<script>\r\nimport carTable from '@/components/car-table'\r\nimport {getCarStatus} from '@/api/operation'\r\nexport default {\r\n  name: 'control',\r\n  data () {\r\n    return {\r\n      carData: {\r\n        carNumber: null,\r\n        doorState: false, //false 门关着，true门打开\r\n        winState: false, //false 窗关着，true窗打开\r\n        voiceState: false,\r\n        left_f_lock: false,\r\n        right_f_lock: false,\r\n        left_b_lock:false,\r\n        right_b_lock: false\r\n      },\r\n      btns: [\r\n        {label: '解锁',type: 1},\r\n        {label: '落锁',type: 2},\r\n        {label: '降窗',type: 3},\r\n        {label: '升窗',type: 4},\r\n        // {label: '开灯',type: 5},\r\n        // {label: '关灯',type: 6},\r\n        {label: '寻车',type: 7}\r\n      ],\r\n      loadingText: '',\r\n      stompClient: null,\r\n      loading: false,\r\n      showLockState: false,\r\n      showVoiceState: false\r\n    }\r\n  },\r\n  mounted() {\r\n    setTimeout(() => {\r\n    },20)\r\n  },\r\n  methods:{\r\n    onBtnClick(item){\r\n      if(!this.carData.carNumber){\r\n        this.$message({\r\n          message: '请选择在线车辆进行远程控制',\r\n          type: 'error'\r\n        })\r\n        return false\r\n      }\r\n      if(this.carData.doorState){\r\n        if(item.type===2){\r\n          this.$alert('请关好车门！', '提示', {\r\n            confirmButtonText: '确定'\r\n          })\r\n          return false\r\n        }\r\n      }\r\n      this.onSendMsg(item)\r\n    },\r\n    // type为控制类型\r\n    onSendMsg(item){\r\n      let userid = window.sessionStorage.getItem('userid')\r\n      this.loadingText = `${item.label}中...`\r\n      this.loading = true\r\n      if(item.type>4){\r\n        this.showVoiceState = true\r\n      }\r\n      if(!this.stompClient || !this.stompClient.connected){\r\n        // 建立socket连接并且订阅消息\r\n        let socket = new SockJS(`${process.env.BASE_API}/my-websocket`)\r\n        this.stompClient = Stomp.over(socket)\r\n        this.stompClient.connect({}, (frame) => {\r\n          // subscribe订阅消息，接收后台消息\r\n          this.stompClient.subscribe(`/topic/web/${userid}/remote_ctl_notify`, (msg) => {\r\n            let res = JSON.parse(msg.body)\r\n            this.stompClient.disconnect() // 关闭socket连接\r\n            if(res.ret == 0){\r\n              // if(item.type==1){\r\n              //   this.carData.left_f_lock = true\r\n              //   this.carData.right_f_lock = true\r\n              //   this.carData.left_b_lock = true\r\n              //   this.carData.right_b_lock = true\r\n              // }\r\n              // if(item.type==2){\r\n              //   this.carData.left_f_lock = false\r\n              //   this.carData.right_f_lock = false\r\n              //   this.carData.left_b_lock = false\r\n              //   this.carData.right_b_lock = false\r\n              // }\r\n              if(item.type==1||item.type==2){\r\n                getCarStatus({vehicle_number: this.carData.carNumber}).then(res=>{\r\n                  let {ret,msg,datas} = res.data\r\n                  if(ret == 0){\r\n                    this.carData.left_f_lock = datas.left_f_lock==1?true:false\r\n                    this.carData.right_f_lock = datas.right_f_lock==1?true:false\r\n                    this.carData.left_b_lock = datas.left_b_lock==1?true:false\r\n                    this.carData.right_b_lock = datas.right_b_lock==1?true:false\r\n                  }\r\n                })\r\n              }\r\n              this.$alert(`${item.label}成功`, '提示', {\r\n                confirmButtonText: '确定'\r\n              })\r\n              this.loading = false\r\n            }else{\r\n              this.$alert(res.msg, '提示', {\r\n                confirmButtonText: '确定'\r\n              })\r\n              this.loading = false\r\n            }\r\n            if(item.type>4){\r\n              this.showVoiceState = false\r\n            }\r\n          })\r\n          // send发送消息，发送前端消息\r\n          this.stompClient.send(\"/web/remote_control\", {}, JSON.stringify({\r\n            'vehicle_number' : this.carData.carNumber,\r\n            'cmd_type': item.type,\r\n            'user_id': userid\r\n          }))\r\n        })\r\n      }\r\n    },\r\n    // 表格车牌号单元格点击事件\r\n    onCarTableCellClick(row, column, cell, event){\r\n      // this.carData = null\r\n      if(row.is_online){\r\n        this.showLockState = false\r\n        getCarStatus({vehicle_number: row.vehicle_number}).then(res=>{\r\n          let {ret,msg,datas} = res.data\r\n          if(ret == 0){\r\n            this.carData.carNumber = datas.vehicle_number\r\n            this.carData.doorState = datas.door_state==1?true:false\r\n            this.carData.winState = datas.windows_state==1?true:false\r\n            this.carData.left_f_lock = datas.left_f_lock==1?true:false\r\n            this.carData.right_f_lock = datas.right_f_lock==1?true:false\r\n            this.carData.left_b_lock = datas.left_b_lock==1?true:false\r\n            this.carData.right_b_lock = datas.right_b_lock==1?true:false\r\n            this.carData.voiceState = false\r\n            this.showLockState = true //显示锁的状态\r\n          }\r\n        })\r\n      }else{\r\n        this.$message({\r\n          message: '请选择在线的车辆进行远程控制',\r\n          type: 'error'\r\n        })\r\n      }\r\n    },\r\n  },\r\n  components:{\r\n    carTable\r\n  }\r\n}\r\n</script>\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// src/pages/operation/control/control.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('section',{staticClass:\"control\"},[_c('el-container',[_c('el-main',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.loading),expression:\"loading\"}],attrs:{\"element-loading-text\":_vm.loadingText,\"element-loading-background\":\"rgba(255, 255, 255, 0.7)\"}},[_c('div',{staticClass:\"car-box\"},[_c('div',{staticClass:\"car\"},[(_vm.showLockState)?_c('div',{staticClass:\"lock-top clearfix\"},[_c('div',{class:['left',{on:_vm.carData.left_f_lock}]}),_vm._v(\" \"),_c('div',{class:['right',{on:_vm.carData.right_f_lock}]})]):_vm._e(),_vm._v(\" \"),(_vm.showLockState)?_c('div',{staticClass:\"lock-bottom clearfix\"},[_c('div',{class:['left',{on: _vm.carData.left_b_lock}]}),_vm._v(\" \"),_c('div',{class:['right',{on: _vm.carData.right_b_lock}]})]):_vm._e(),_vm._v(\" \"),(_vm.showVoiceState)?_c('div',{class:['center','on']}):_vm._e()])]),_vm._v(\" \"),_c('ul',_vm._l((_vm.btns),function(item){return _c('li',{on:{\"click\":function($event){_vm.onBtnClick(item)}}},[_vm._v(_vm._s(item.label))])}))]),_vm._v(\" \"),_c('el-aside',{attrs:{\"width\":\"320px\"}},[_c('el-tabs',{attrs:{\"type\":\"border-card\"}},[_c('el-tab-pane',{attrs:{\"label\":\"车辆列表\"}},[_c('carTable',{on:{\"onCarTableCellClick\":_vm.onCarTableCellClick}})],1)],1)],1)],1)],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/_vue-loader@13.7.1@vue-loader/lib/template-compiler?{\"id\":\"data-v-6254b49a\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/_vue-loader@13.7.1@vue-loader/lib/selector.js?type=template&index=0!./src/pages/operation/control/control.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../../node_modules/_extract-text-webpack-plugin@3.0.2@extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../../node_modules/_vue-loader@13.7.1@vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-6254b49a\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!less-loader?{\\\"sourceMap\\\":true}!../../../../node_modules/_vue-loader@13.7.1@vue-loader/lib/selector?type=styles&index=0!./control.vue\")\n}\nvar normalizeComponent = require(\"!../../../../node_modules/_vue-loader@13.7.1@vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../../node_modules/_vue-loader@13.7.1@vue-loader/lib/selector?type=script&index=0!./control.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../../node_modules/_vue-loader@13.7.1@vue-loader/lib/selector?type=script&index=0!./control.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../../node_modules/_vue-loader@13.7.1@vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-6254b49a\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../../node_modules/_vue-loader@13.7.1@vue-loader/lib/selector?type=template&index=0!./control.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-6254b49a\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pages/operation/control/control.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}