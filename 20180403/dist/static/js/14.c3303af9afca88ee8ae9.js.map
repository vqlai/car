{"version":3,"sources":["webpack:///src/pages/traffic/rental/rental.vue","webpack:///./src/pages/traffic/rental/rental.vue?2e7c","webpack:///./src/pages/traffic/rental/rental.vue"],"names":["rental","_this","this","_getRental","_this2","currentPage","pageSize","queryText1","queryText2","queryStartTime","queryEndTime","cur_page","page_size","item_counts","list","msg","value1","value2","chargeType","_iteratorNormalCompletion","item","_step","value","type","_this3","unit_value","_this4","catList","chargeSchemeList","_this5","phone","identity","licence","carId","originVal","onCloseRentalDialog","_this6","datas","_this7","_this8","then","_ref","size","page","cellValue","per_unit","searchBox","rental_rental","render","_vm","_h","$createElement","_c","_self","staticClass","attrs","queryTwo","addBtn","queryDate","exportBtn","on","onSearch","onSearchClick","onAdd","onAddRentalClick","onExport","onExportClick","_v","title","visible","rentalDialog","model","width","update:visible","$event","close","ref","formData","label-width","rules","formRule","label","prop","auto-complete","callback","$$v","$set","expression","placeholder","filterable","change","onLoadOriginValByCar","_l","key","car_id","vehicle_number","onLoadOriginValByType","charge_scheme_id","scheme_name","originValType","_s","_e","clearable","format","value-format","slot","click","onSubmitForm","directives","name","rawName","element-loading-text","staticStyle","data","tableData","empty-text","emptyText","border","height","formatter","formatCharge","scopedSlots","_u","fn","scope","row","charge","formatStatus","state","onReturnCarClick","onModifyCharge","returnCarDialog","returnCarInfo","start_time","end_time","charge_type","comfirmReturnClick","current-page","page-sizes","page-size","layout","total","size-change","onSizeChange","current-change","onCurrentChange","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/14.c3303af9afca88ee8ae9.js","sourcesContent":["<style scoped lang=\"less\">\r\n  @import \"./rental.less\";\r\n</style>\r\n\r\n<template>\r\n\t<section class=\"rental main-panel\">\r\n    <searchBox @onSearch=\"onSearchClick\" :queryTwo=\"true\" :addBtn=\"true\" @onAdd=\"onAddRentalClick\" :queryDate=\"true\" :exportBtn=\"true\" @onExport=\"onExportClick\"></searchBox>\r\n    <el-dialog title=\"新增租车\" :visible.sync=\"rentalDialog\" model=\"right\" width=\"30%\" @close=\"onCloseRentalDialog\">\r\n      <el-form :model=\"formData\" label-width=\"100px\" :rules=\"formRule\" ref=\"rentalForm\">\r\n        <el-form-item label=\"手机号\" prop=\"phone\">\r\n          <el-input v-model=\"formData.phone\" auto-complete=\"off\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"身份证\" prop=\"identity\">\r\n          <el-input v-model=\"formData.identity\" auto-complete=\"off\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"驾驶证\" prop=\"licence\">\r\n          <el-input v-model=\"formData.licence\" auto-complete=\"off\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"车牌号\" prop=\"carId\">\r\n          <el-select v-model=\"formData.carId\" placeholder=\"请选择租用车牌号\" filterable @change=\"onLoadOriginValByCar\">\r\n            <el-option\r\n              v-for=\"item in carOption\"\r\n              :key=\"item.car_id\"\r\n              :label=\"item.vehicle_number\"\r\n              :value=\"item.car_id\">\r\n            </el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item label=\"收费方式\" prop=\"chargeType\">\r\n          <el-select v-model=\"formData.chargeType\" placeholder=\"请选择收费方式\" filterable @change=\"onLoadOriginValByType\">\r\n            <el-option\r\n              v-for=\"item in chargeOption\"\r\n              :key=\"item.charge_scheme_id\"\r\n              :label=\"item.scheme_name\"\r\n              :value=\"item.charge_scheme_id\">\r\n            </el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item :label=\"originValType===1?'起始里程':'起始油耗'\" prop=\"originVal\" v-if=\"formData.chargeType && originValType !== 3\">\r\n          <el-input v-model=\"formData.originVal\" auto-complete=\"off\"></el-input>\r\n          <span>{{originValType===1?'公里':'升'}}</span>\r\n        </el-form-item>\r\n        <el-form-item label=\"起始时间\" v-if=\"formData.chargeType && originValType === 3\"\r\n        prop=\"originTime\">\r\n          <el-date-picker\r\n            :clearable=\"false\"\r\n            v-model=\"formData.originTime\"\r\n            type=\"datetime\"\r\n            format=\"yyyy-MM-dd HH:mm:ss\"\r\n            value-format=\"timestamp\"\r\n            placeholder=\"选择开始时间\">\r\n          </el-date-picker>\r\n        </el-form-item>\r\n      </el-form>\r\n      <div slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"rentalDialog=false\">取 消</el-button>\r\n        <el-button type=\"primary\" @click=\"onSubmitForm\">保 存</el-button>\r\n      </div>\r\n    </el-dialog>\r\n    <div v-loading=\"loading\" element-loading-text=\"数据加载中...\">\r\n  \t\t<el-table\r\n        :data=\"tableData\"\r\n        :empty-text=\"emptyText\"\r\n        border\r\n        height=\"531\"\r\n        style=\"width: 100%\">\r\n        <el-table-column\r\n          prop=\"order_number\"\r\n          label=\"订单号\">\r\n        </el-table-column>\r\n        <el-table-column\r\n          prop=\"vehicle_number\"\r\n          width=\"100\" \r\n          label=\"车牌号\">\r\n        </el-table-column>\r\n        <el-table-column\r\n          prop=\"vehicle_brand\"\r\n          label=\"车辆品牌\">\r\n        </el-table-column>\r\n        <el-table-column\r\n          prop=\"id_card\"\r\n          label=\"身份证号\">\r\n        </el-table-column>\r\n        <el-table-column\r\n          prop=\"driver_card\"\r\n          label=\"驾驶证号\">\r\n        </el-table-column> \r\n        <el-table-column\r\n          prop=\"phone_number\"\r\n          width=\"100\" \r\n          label=\"手机号\">\r\n        </el-table-column>\r\n        <el-table-column\r\n          prop=\"charge_type\"\r\n          :formatter=\"formatCharge\"\r\n          label=\"收费方式\">\r\n        </el-table-column>\r\n        <el-table-column\r\n          prop=\"charge\"\r\n          width=\"100\"\r\n          label=\"当前费用\">\r\n          <template slot-scope=\"scope\">\r\n            <span>{{scope.row.charge?`${scope.row.charge}元`:`-`}}</span>\r\n          </template>\r\n        </el-table-column> \r\n        <el-table-column\r\n          prop=\"state\"\r\n          width=\"80\"\r\n          :formatter=\"formatStatus\"\r\n          label=\"租凭状态\">\r\n        </el-table-column> \r\n        <el-table-column\r\n          prop=\"start_time\"\r\n          width=\"150\"\r\n          label=\"开始时间\">\r\n        </el-table-column>\r\n        <el-table-column\r\n          prop=\"end_time\"\r\n          width=\"150\"\r\n          label=\"结束时间\">\r\n        </el-table-column>\r\n        <el-table-column\r\n          width=\"80\"\r\n          label=\"操作\">\r\n          <template slot-scope=\"scope\">\r\n            <el-button v-if=\"scope.row.state===1\" @click=\"onReturnCarClick(scope.row)\" type=\"text\" size=\"small\" >还车</el-button>\r\n            <el-button type=\"text\" size=\"small\" v-if=\"scope.row.state===2\" @click=\"onModifyCharge(scope.row)\">修改</el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n    </div>\r\n    <el-dialog\r\n      title=\"还车\"\r\n      :visible.sync=\"returnCarDialog\"\r\n      width=\"30%\">\r\n      <div v-if=\"returnCarInfo\">\r\n        <p>开始租车时间：{{returnCarInfo.start_time}}</p>\r\n        <p>结束租车时间：{{returnCarInfo.end_time}}</p>\r\n        <p>计费方式：{{returnCarInfo.charge_type}}</p>\r\n        <!-- <p>计费方式：{{returnCarInfo.charge_type==1?'按公里数收费':returnCarInfo.charge_type==2?'按油耗收费':'按天数收费'}}</p> -->\r\n        <p>收费金额：{{returnCarInfo.charge}}</p>\r\n      </div>\r\n      <span slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"returnCarDialog = false\">取 消</el-button>\r\n        <el-button type=\"primary\" @click=\"comfirmReturnClick\">确 定</el-button>\r\n      </span>\r\n    </el-dialog>\r\n    <el-pagination\r\n      @size-change=\"onSizeChange\"\r\n      @current-change=\"onCurrentChange\"\r\n      :current-page=\"currentPage\"\r\n      :page-sizes=\"[10, 20, 30, 40]\"\r\n      :page-size=\"pageSize\"\r\n      layout=\"total, sizes, prev, pager, next, jumper\"\r\n      :total=\"total\">\r\n    </el-pagination>\r\n\t</section>\r\n</template>\r\n\r\n<script>\r\nimport {getRental,getCarAndCharge,createRentCar,getReturnCarInfo,comfirmReturnCar,modifyCarFee,getCarOriginVal} from '@/api/traffic'\r\nimport validator from '@/common/js/validator'\r\nimport searchBox from '@/components/search-box'\r\nexport default {\r\n  name: 'rental',\r\n  data () {\r\n    return {\r\n    \ttableData: [], \r\n      currentPage: 1, // 当前页\r\n      pageSize: 10, // 每页大小\r\n      total: 0, // 总记录数\r\n      pageFlag: false, // 防止分页快速点击bug\r\n      loading: false,\r\n      emptyText: ' ',\r\n      rentalDialog: false,\r\n      returnCarDialog: false,\r\n      formData: { phone: '', identity: '', licence: '', carId:'', chargeType:'',originVal: '',originTime: null},\r\n      formRule: {\r\n        phone: [{ required: true, message: '请输入手机号码', trigger: 'blur' },{ validator: validator.checkPhone, trigger: 'blur' }],\r\n        identity: [{ required: true, message: '请输入身份证', trigger: 'blur' },{ validator: validator.checkIdentity, trigger: 'blur' }],\r\n        licence: [{ required: true, message: '请输入驾驶证', trigger: 'blur' },{ validator: validator.checkLicence, trigger: 'blur' }],\r\n        carId: [{ required: true, message: '请选择车牌号', trigger: 'change' }],\r\n        chargeType: [{ required: true, message: '请选择收费方式', trigger: 'change' }],\r\n        originVal: [{ required: true, message: '请输入收费方式开始值', trigger: 'blur' },{ validator: validator.checkOriginVal, trigger: 'blur' }],\r\n        originTime:[{ required: true, message: '请选择起始时间', trigger: 'blur' }]\r\n      },\r\n      carOption: [],\r\n      chargeOption: [],\r\n      originValType: 1,\r\n      returnCarInfo: null,\r\n      queryText1: '',\r\n      queryText2: '',\r\n      queryStartTime: '',\r\n      queryEndTime: ''\r\n    }\r\n  },\r\n  mounted() {\r\n    this.$nextTick(()=>{\r\n      this._getRental()\r\n    })\r\n  },\r\n  methods:{\r\n    // 获取汽车租赁列表\r\n    _getRental(){\r\n      let params = {\r\n        page: this.currentPage,\r\n        page_size: this.pageSize,\r\n        vehicle_number: this.queryText1, \r\n        phone_number: this.queryText2,\r\n        start_time: this.queryStartTime,\r\n        end_time: this.queryEndTime\r\n      }\r\n      this.loading = true\r\n      getRental(params).then((res)=>{\r\n        this.pageFlag = false\r\n        if(res.data.ret == 0){\r\n          this.currentPage = res.data.datas.cur_page\r\n          this.pageSize = res.data.datas.page_size\r\n          this.total = res.data.datas.item_counts\r\n          this.tableData = [...res.data.datas.list]\r\n        }else{\r\n          this.$message({\r\n            message: res.data.msg,\r\n            type: 'error'\r\n          })\r\n        }\r\n        this.loading = false // 关闭加载动画\r\n        if(!this.tableData.length) this.emptyText = '暂无数据'\r\n      })\r\n    },\r\n    // 搜索\r\n    onSearchClick(value1, value2, value3){\r\n      this.queryText1 = value1\r\n      this.queryText2 = value2\r\n      if(value3){\r\n        this.queryStartTime = value3[0]\r\n        this.queryEndTime = value3[1]\r\n      }else{\r\n        this.queryStartTime = ''\r\n        this.queryEndTime = ''\r\n      }\r\n      if(this.currentPage === 1 ){\r\n        this._getRental()\r\n      }else{\r\n        // 通过改变页数来触发事件从而进行搜索\r\n        this.currentPage = 1\r\n      }\r\n    },\r\n    // 下拉框改变获取到起始值\r\n    onLoadOriginValByCar(val){\r\n      if(this.formData.carId && this.formData.chargeType){\r\n        this._getCarOriginVal({car_id: this.formData.carId,charge_scheme_id: this.formData.chargeType})\r\n      }\r\n    },\r\n    onLoadOriginValByType(val){\r\n      for(let item of this.chargeOption){\r\n        if(item.charge_scheme_id == val){\r\n          this.originValType = item.type\r\n        }\r\n      }\r\n      if(this.formData.carId && this.formData.chargeType){\r\n        this._getCarOriginVal({car_id: this.formData.carId,charge_scheme_id: this.formData.chargeType})\r\n      }\r\n    },\r\n    _getCarOriginVal(params){\r\n      getCarOriginVal(params).then(res=>{\r\n        if(res.data.ret == 0){\r\n          if(this.originValType === 3){\r\n            this.formData.originTime = new Date(res.data.datas.unit_value)\r\n          }else{\r\n            this.formData.originVal = res.data.datas.unit_value\r\n          }\r\n        }\r\n      })\r\n    },\r\n    // 导出\r\n    onExportClick(){\r\n      location.href = `${process.env.BASE_API}/orders/export?vehicle_number=${this.queryText1}&phone_number=${this.queryText2}&start_time=${this.queryStartTime}&end_time=${this.queryEndTime}`\r\n    },\r\n    // 打开新增租车弹窗\r\n    onAddRentalClick(){\r\n      this.rentalDialog = true\r\n      if(!this.carOption.length && !this.chargeOption.length){\r\n        getCarAndCharge().then((res)=>{\r\n          if(res.data.ret == 0){\r\n            this.carOption = res.data.datas.catList\r\n            this.chargeOption = res.data.datas.chargeSchemeList\r\n          }\r\n        })\r\n      }\r\n    },\r\n    // 关闭新增租车弹窗\r\n    onCloseRentalDialog(){\r\n      this.$refs.rentalForm.resetFields() // 重置表单\r\n    },\r\n    onSubmitForm(){\r\n      this.$refs['rentalForm'].validate((valid) => {\r\n        if (valid) {\r\n          let params =　{\r\n            phone_number: this.formData.phone,\r\n            id_card: this.formData.identity,\r\n            driver_card: this.formData.licence,\r\n            car_id: this.formData.carId,\r\n            charge_scheme_id  : this.formData.chargeType,\r\n            init_value: this.originValType===3? this.formData.originTime/1000:this.formData.originVal\r\n          }\r\n          createRentCar(params).then((res)=>{\r\n            this.loadTableData(res,1)\r\n          })\r\n          this.onCloseRentalDialog()\r\n        } else {\r\n          console.log('error submit!!')\r\n          return false;\r\n        }\r\n      })\r\n    },\r\n    // 还车信息回显\r\n    onReturnCarClick(row){\r\n      getReturnCarInfo({orders_id: row.orders_id}).then((res)=>{\r\n        if(res.data.ret == 0){\r\n          this.returnCarInfo = res.data.datas\r\n          this.returnCarInfo.charge_type = this.returnCarInfo.charge_type==1?'按公里数收费':this.returnCarInfo.charge_type==2?'按油耗收费':'按天数收费'\r\n          this.returnCarDialog = true\r\n        }else{\r\n          this.$message({\r\n            message: res.data.msg,\r\n            type: 'error'\r\n          })\r\n        }\r\n      })\r\n    },\r\n    // 确定还车\r\n    comfirmReturnClick(){\r\n      comfirmReturnCar({orders_id: this.returnCarInfo.orders_id}).then((res)=>{\r\n        this.loadTableData(res,2)\r\n      })\r\n    },\r\n    // 结算价格修改\r\n    onModifyCharge(row){\r\n      this.$prompt('请输入金额', '提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n        inputPattern: /(^[1-9]([0-9]+)?(\\.[0-9]{1,2})?$)|(^(0){1}$)|(^[0-9]\\.[0-9]([0-9])?$)/,\r\n        inputErrorMessage: '金额格式不正确'\r\n      }).then(({ value }) => {\r\n        modifyCarFee({orders_id: row.orders_id,charge:value}).then(res=>{\r\n          this.loadTableData(res,4)\r\n        })\r\n      }).catch(() => {\r\n        console.log('close') \r\n      })             \r\n    },\r\n    // 重新加载数据 type为1则是新增状态，2为编辑状态，3为删除状态，4为费用修改成功\r\n    loadTableData(res, status){\r\n      if(res.data.ret == 0){\r\n        this.rentalDialog = false\r\n        this.returnCarDialog = false\r\n        this._getRental()\r\n        let msg = ''\r\n        if(status === 1){\r\n          msg = '添加成功！'\r\n        }else if(status === 2){\r\n          msg = '还车成功！'\r\n        }else if(status === 3){\r\n          msg = '删除成功！'\r\n        }else if(status === 4){\r\n          msg = '费用修改成功！'\r\n        }else{}\r\n        this.$message({\r\n          message: msg,\r\n          type: 'success'\r\n        })\r\n      }else{\r\n        this.$message({\r\n          message: res.data.msg,\r\n          type: 'error'\r\n        })\r\n      }\r\n    },\r\n    // 分页每页显示大小变化事件\r\n    onSizeChange(size){\r\n      this.pageSize = size \r\n      this._getRental()\r\n    },\r\n    // 当前页数变化事件\r\n    onCurrentChange(page){\r\n      if(!this.pageFlag){\r\n        this.pageFlag = true\r\n        this.currentPage = page\r\n        this._getRental()\r\n      }\r\n    },\r\n    formatCharge(row, column, cellValue){\r\n      switch(cellValue){\r\n        case 1:\r\n          return `按里程，${row.per_unit}元/公里`\r\n          break\r\n        case 2:\r\n          return `按油耗，${row.per_unit}元/升`\r\n          break\r\n        case 3:\r\n          return `按天数，${row.per_unit}元/日`\r\n          break\r\n        default:\r\n          return '-'\r\n      }\r\n    },\r\n    formatStatus(row, column, cellValue){\r\n      switch(cellValue){\r\n        case 1:\r\n          return `已出租`\r\n          break\r\n        case 2:\r\n          return `支付中`\r\n          break\r\n        case 3:\r\n          return `已还车`\r\n          break\r\n        default:\r\n          return '-'\r\n      }\r\n    }\r\n  },\r\n  components:{\r\n    searchBox\r\n  }\r\n}\r\n</script>\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// src/pages/traffic/rental/rental.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('section',{staticClass:\"rental main-panel\"},[_c('searchBox',{attrs:{\"queryTwo\":true,\"addBtn\":true,\"queryDate\":true,\"exportBtn\":true},on:{\"onSearch\":_vm.onSearchClick,\"onAdd\":_vm.onAddRentalClick,\"onExport\":_vm.onExportClick}}),_vm._v(\" \"),_c('el-dialog',{attrs:{\"title\":\"新增租车\",\"visible\":_vm.rentalDialog,\"model\":\"right\",\"width\":\"30%\"},on:{\"update:visible\":function($event){_vm.rentalDialog=$event},\"close\":_vm.onCloseRentalDialog}},[_c('el-form',{ref:\"rentalForm\",attrs:{\"model\":_vm.formData,\"label-width\":\"100px\",\"rules\":_vm.formRule}},[_c('el-form-item',{attrs:{\"label\":\"手机号\",\"prop\":\"phone\"}},[_c('el-input',{attrs:{\"auto-complete\":\"off\"},model:{value:(_vm.formData.phone),callback:function ($$v) {_vm.$set(_vm.formData, \"phone\", $$v)},expression:\"formData.phone\"}})],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"身份证\",\"prop\":\"identity\"}},[_c('el-input',{attrs:{\"auto-complete\":\"off\"},model:{value:(_vm.formData.identity),callback:function ($$v) {_vm.$set(_vm.formData, \"identity\", $$v)},expression:\"formData.identity\"}})],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"驾驶证\",\"prop\":\"licence\"}},[_c('el-input',{attrs:{\"auto-complete\":\"off\"},model:{value:(_vm.formData.licence),callback:function ($$v) {_vm.$set(_vm.formData, \"licence\", $$v)},expression:\"formData.licence\"}})],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"车牌号\",\"prop\":\"carId\"}},[_c('el-select',{attrs:{\"placeholder\":\"请选择租用车牌号\",\"filterable\":\"\"},on:{\"change\":_vm.onLoadOriginValByCar},model:{value:(_vm.formData.carId),callback:function ($$v) {_vm.$set(_vm.formData, \"carId\", $$v)},expression:\"formData.carId\"}},_vm._l((_vm.carOption),function(item){return _c('el-option',{key:item.car_id,attrs:{\"label\":item.vehicle_number,\"value\":item.car_id}})}))],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"收费方式\",\"prop\":\"chargeType\"}},[_c('el-select',{attrs:{\"placeholder\":\"请选择收费方式\",\"filterable\":\"\"},on:{\"change\":_vm.onLoadOriginValByType},model:{value:(_vm.formData.chargeType),callback:function ($$v) {_vm.$set(_vm.formData, \"chargeType\", $$v)},expression:\"formData.chargeType\"}},_vm._l((_vm.chargeOption),function(item){return _c('el-option',{key:item.charge_scheme_id,attrs:{\"label\":item.scheme_name,\"value\":item.charge_scheme_id}})}))],1),_vm._v(\" \"),(_vm.formData.chargeType && _vm.originValType !== 3)?_c('el-form-item',{attrs:{\"label\":_vm.originValType===1?'起始里程':'起始油耗',\"prop\":\"originVal\"}},[_c('el-input',{attrs:{\"auto-complete\":\"off\"},model:{value:(_vm.formData.originVal),callback:function ($$v) {_vm.$set(_vm.formData, \"originVal\", $$v)},expression:\"formData.originVal\"}}),_vm._v(\" \"),_c('span',[_vm._v(_vm._s(_vm.originValType===1?'公里':'升'))])],1):_vm._e(),_vm._v(\" \"),(_vm.formData.chargeType && _vm.originValType === 3)?_c('el-form-item',{attrs:{\"label\":\"起始时间\",\"prop\":\"originTime\"}},[_c('el-date-picker',{attrs:{\"clearable\":false,\"type\":\"datetime\",\"format\":\"yyyy-MM-dd HH:mm:ss\",\"value-format\":\"timestamp\",\"placeholder\":\"选择开始时间\"},model:{value:(_vm.formData.originTime),callback:function ($$v) {_vm.$set(_vm.formData, \"originTime\", $$v)},expression:\"formData.originTime\"}})],1):_vm._e()],1),_vm._v(\" \"),_c('div',{staticClass:\"dialog-footer\",attrs:{\"slot\":\"footer\"},slot:\"footer\"},[_c('el-button',{on:{\"click\":function($event){_vm.rentalDialog=false}}},[_vm._v(\"取 消\")]),_vm._v(\" \"),_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":_vm.onSubmitForm}},[_vm._v(\"保 存\")])],1)],1),_vm._v(\" \"),_c('div',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.loading),expression:\"loading\"}],attrs:{\"element-loading-text\":\"数据加载中...\"}},[_c('el-table',{staticStyle:{\"width\":\"100%\"},attrs:{\"data\":_vm.tableData,\"empty-text\":_vm.emptyText,\"border\":\"\",\"height\":\"531\"}},[_c('el-table-column',{attrs:{\"prop\":\"order_number\",\"label\":\"订单号\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"prop\":\"vehicle_number\",\"width\":\"100\",\"label\":\"车牌号\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"prop\":\"vehicle_brand\",\"label\":\"车辆品牌\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"prop\":\"id_card\",\"label\":\"身份证号\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"prop\":\"driver_card\",\"label\":\"驾驶证号\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"prop\":\"phone_number\",\"width\":\"100\",\"label\":\"手机号\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"prop\":\"charge_type\",\"formatter\":_vm.formatCharge,\"label\":\"收费方式\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"prop\":\"charge\",\"width\":\"100\",\"label\":\"当前费用\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_c('span',[_vm._v(_vm._s(scope.row.charge?((scope.row.charge) + \"元\"):\"-\"))])]}}])}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"prop\":\"state\",\"width\":\"80\",\"formatter\":_vm.formatStatus,\"label\":\"租凭状态\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"prop\":\"start_time\",\"width\":\"150\",\"label\":\"开始时间\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"prop\":\"end_time\",\"width\":\"150\",\"label\":\"结束时间\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"width\":\"80\",\"label\":\"操作\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [(scope.row.state===1)?_c('el-button',{attrs:{\"type\":\"text\",\"size\":\"small\"},on:{\"click\":function($event){_vm.onReturnCarClick(scope.row)}}},[_vm._v(\"还车\")]):_vm._e(),_vm._v(\" \"),(scope.row.state===2)?_c('el-button',{attrs:{\"type\":\"text\",\"size\":\"small\"},on:{\"click\":function($event){_vm.onModifyCharge(scope.row)}}},[_vm._v(\"修改\")]):_vm._e()]}}])})],1)],1),_vm._v(\" \"),_c('el-dialog',{attrs:{\"title\":\"还车\",\"visible\":_vm.returnCarDialog,\"width\":\"30%\"},on:{\"update:visible\":function($event){_vm.returnCarDialog=$event}}},[(_vm.returnCarInfo)?_c('div',[_c('p',[_vm._v(\"开始租车时间：\"+_vm._s(_vm.returnCarInfo.start_time))]),_vm._v(\" \"),_c('p',[_vm._v(\"结束租车时间：\"+_vm._s(_vm.returnCarInfo.end_time))]),_vm._v(\" \"),_c('p',[_vm._v(\"计费方式：\"+_vm._s(_vm.returnCarInfo.charge_type))]),_vm._v(\" \"),_c('p',[_vm._v(\"收费金额：\"+_vm._s(_vm.returnCarInfo.charge))])]):_vm._e(),_vm._v(\" \"),_c('span',{staticClass:\"dialog-footer\",attrs:{\"slot\":\"footer\"},slot:\"footer\"},[_c('el-button',{on:{\"click\":function($event){_vm.returnCarDialog = false}}},[_vm._v(\"取 消\")]),_vm._v(\" \"),_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":_vm.comfirmReturnClick}},[_vm._v(\"确 定\")])],1)]),_vm._v(\" \"),_c('el-pagination',{attrs:{\"current-page\":_vm.currentPage,\"page-sizes\":[10, 20, 30, 40],\"page-size\":_vm.pageSize,\"layout\":\"total, sizes, prev, pager, next, jumper\",\"total\":_vm.total},on:{\"size-change\":_vm.onSizeChange,\"current-change\":_vm.onCurrentChange}})],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/_vue-loader@13.7.1@vue-loader/lib/template-compiler?{\"id\":\"data-v-7735d5bd\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/_vue-loader@13.7.1@vue-loader/lib/selector.js?type=template&index=0!./src/pages/traffic/rental/rental.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../../node_modules/_extract-text-webpack-plugin@3.0.2@extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../../node_modules/_vue-loader@13.7.1@vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-7735d5bd\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!less-loader?{\\\"sourceMap\\\":true}!../../../../node_modules/_vue-loader@13.7.1@vue-loader/lib/selector?type=styles&index=0!./rental.vue\")\n}\nvar normalizeComponent = require(\"!../../../../node_modules/_vue-loader@13.7.1@vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../../node_modules/_vue-loader@13.7.1@vue-loader/lib/selector?type=script&index=0!./rental.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../../node_modules/_vue-loader@13.7.1@vue-loader/lib/selector?type=script&index=0!./rental.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../../node_modules/_vue-loader@13.7.1@vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-7735d5bd\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../../node_modules/_vue-loader@13.7.1@vue-loader/lib/selector?type=template&index=0!./rental.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-7735d5bd\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pages/traffic/rental/rental.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}