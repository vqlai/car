webpackJsonp([21],{RDRB:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("HzJ8"),i=a.n(n),r=a("0gIb"),l=a("UW1m"),o=a("egIO"),s=a("865i"),c={name:"monitor",data:function(){return{mapObj:null,multipleSelection:null,timer:null,carMarker:null,infoWindow:null,winStatus:!1}},mounted:function(){var t=this;setTimeout(function(){t._getAllCar(),t.timer&&clearInterval(t.timer)},20)},methods:{_getAllCar:function(){var t=this;Object(s.c)().then(function(e){if(0==e.data.ret){var a=!0,n=!1,l=void 0;try{for(var o,s=i()(e.data.datas);!(a=(o=s.next()).done);a=!0){var c=o.value;Object(r.a)(c.longitude,c.latitude)}}catch(t){n=!0,l=t}finally{try{!a&&s.return&&s.return()}finally{if(n)throw l}}}else t.$message({message:e.data.msg,type:"error"})})},onCarTableSelection:function(t){this.multipleSelection=t},onCarTableCellClick:function(t,e,a,n){var i=this;"vehicle_number"==e.property&&(this.timer&&clearInterval(this.timer),this.carMarker=null,this.winStatus=!1,this.mapObj.clearOverlays(),this._getMonitorCarInfo(t),this.timer=setInterval(function(){i.winStatus=!1,i._getMonitorCarInfo(t)},1e4))},_getMonitorCarInfo:function(t){var e=this;if("monitor"!==this.$route.name)return clearInterval(this.timer),!1;Object(s.g)({vehicle_number:t.vehicle_number}).then(function(t){if(0==t.data.ret){var a=new BMap.Point(t.data.datas.longitude,t.data.datas.latitude);e.carMarker?e.carMarker.setPosition(a):(e.winStatus=!0,e.carMarker=Object(r.a)(t.data.datas.longitude,t.data.datas.latitude)),e.carMarker.addEventListener("click",function(a){e.loadMapDialog(t.data.datas)}),e.loadMapDialog(t.data.datas),e.mapObj.setViewport([a])}else clearInterval(e.timer),e.$message({message:"车辆实时数据获取失败，请重新获取！",type:"error"})})},loadMapDialog:function(t){var e=this;Object(r.b)(t.longitude,t.latitude).then(function(a){t.address=a,e.winStatus?(e.infoWindow=Object(r.e)(t),e.carMarker.openInfoWindow(e.infoWindow)):e.infoWindow.setContent(Object(r.f)(t))})},created:function(){this.timer&&clearInterval(this.timer)},getMapObj:function(t){this.mapObj=t}},components:{mapPanel:l.a,carTable:o.a}},d={render:function(){var t=this.$createElement,e=this._self._c||t;return e("section",{staticClass:"monitor"},[e("el-container",[e("el-main",[e("map-panel",{attrs:{isNeedMapObj:!0,defaultZoom:5,defaultCity:"北京"},on:{sendMapObj:this.getMapObj}})],1),this._v(" "),e("el-aside",{attrs:{width:"320px"}},[e("el-tabs",{attrs:{type:"border-card"}},[e("el-tab-pane",{attrs:{label:"车辆列表"}},[e("carTable",{attrs:{showSelection:!0},on:{onCarTableCellClick:this.onCarTableCellClick,onCarTableSelection:this.onCarTableSelection}})],1)],1)],1)],1)],1)},staticRenderFns:[]};var u=a("Z0/y")(c,d,!1,function(t){a("nP66")},"data-v-44bd1bde",null);e.default=u.exports},nP66:function(t,e){}});
//# sourceMappingURL=21.deb8d633ac5007e2c8fc.js.map