webpackJsonp([14],{"8OPd":function(e,t){},UExa:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("HzJ8"),i=a.n(r),n=a("IHPB"),o=a.n(n),l=a("8RsO"),s=a("3Ri9"),c={name:"rental",data:function(){return{tableData:[],currentPage:1,pageSize:10,total:0,pageFlag:!1,loading:!1,emptyText:" ",rentalDialog:!1,returnCarDialog:!1,formData:{phone:"",identity:"",licence:"",carId:"",chargeType:"",originVal:"",originTime:null},formRule:{phone:[{required:!0,message:"请输入手机号码",trigger:"blur"},{validator:s.a.checkPhone,trigger:"blur"}],identity:[{required:!0,message:"请输入身份证",trigger:"blur"},{validator:s.a.checkIdentity,trigger:"blur"}],licence:[{required:!0,message:"请输入驾驶证",trigger:"blur"},{validator:s.a.checkLicence,trigger:"blur"}],carId:[{required:!0,message:"请选择车牌号",trigger:"change"}],chargeType:[{required:!0,message:"请选择收费方式",trigger:"change"}],originVal:[{required:!0,message:"请输入收费方式开始值",trigger:"blur"},{validator:s.a.checkOriginVal,trigger:"blur"}],originTime:[{required:!0,message:"请选择起始时间",trigger:"blur"}]},carOption:[],chargeOption:[],originValType:1,returnCarInfo:null,queryText1:"",queryText2:"",queryStartTime:"",queryEndTime:""}},mounted:function(){var e=this;this.$nextTick(function(){e._getRental()})},methods:{_getRental:function(){var e=this,t={page:this.currentPage,page_size:this.pageSize,vehicle_number:this.queryText1,phone_number:this.queryText2,start_time:this.queryStartTime,end_time:this.queryEndTime};this.loading=!0,Object(l.o)(t).then(function(t){e.pageFlag=!1,0==t.data.ret?(e.currentPage=t.data.datas.cur_page,e.pageSize=t.data.datas.page_size,e.total=t.data.datas.item_counts,e.tableData=[].concat(o()(t.data.datas.list))):e.$message({message:t.data.msg,type:"error"}),e.loading=!1,e.tableData.length||(e.emptyText="暂无数据")})},onSearchClick:function(e,t,a){this.queryText1=e,this.queryText2=t,a?(this.queryStartTime=a[0],this.queryEndTime=a[1]):(this.queryStartTime="",this.queryEndTime=""),1===this.currentPage?this._getRental():this.currentPage=1},onLoadOriginValByCar:function(e){this.formData.carId&&this.formData.chargeType&&this._getCarOriginVal({car_id:this.formData.carId,charge_scheme_id:this.formData.chargeType})},onLoadOriginValByType:function(e){var t=!0,a=!1,r=void 0;try{for(var n,o=i()(this.chargeOption);!(t=(n=o.next()).done);t=!0){var l=n.value;l.charge_scheme_id==e&&(this.originValType=l.type)}}catch(e){a=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(a)throw r}}this.formData.carId&&this.formData.chargeType&&this._getCarOriginVal({car_id:this.formData.carId,charge_scheme_id:this.formData.chargeType})},_getCarOriginVal:function(e){var t=this;Object(l.l)(e).then(function(e){0==e.data.ret&&(3===t.originValType?t.formData.originTime=new Date(e.data.datas.unit_value):t.formData.originVal=e.data.datas.unit_value)})},onExportClick:function(){location.href="//iotsvr.he-live.com:8002/orders/export?vehicle_number="+this.queryText1+"&phone_number="+this.queryText2+"&start_time="+this.queryStartTime+"&end_time="+this.queryEndTime},onAddRentalClick:function(){var e=this;this.rentalDialog=!0,this.carOption.length||this.chargeOption.length||Object(l.k)().then(function(t){0==t.data.ret&&(e.carOption=t.data.datas.catList,e.chargeOption=t.data.datas.chargeSchemeList)})},onCloseRentalDialog:function(){this.$refs.rentalForm.resetFields()},onSubmitForm:function(){var e=this;this.$refs.rentalForm.validate(function(t){if(!t)return console.log("error submit!!"),!1;var a={phone_number:e.formData.phone,id_card:e.formData.identity,driver_card:e.formData.licence,car_id:e.formData.carId,charge_scheme_id:e.formData.chargeType,init_value:3===e.originValType?e.formData.originTime/1e3:e.formData.originVal};Object(l.f)(a).then(function(t){e.loadTableData(t,1)}),e.onCloseRentalDialog()})},onReturnCarClick:function(e){var t=this;Object(l.p)({orders_id:e.orders_id}).then(function(e){0==e.data.ret?(t.returnCarInfo=e.data.datas,t.returnCarInfo.charge_type=1==t.returnCarInfo.charge_type?"按公里数收费":2==t.returnCarInfo.charge_type?"按油耗收费":"按天数收费",t.returnCarDialog=!0):t.$message({message:e.data.msg,type:"error"})})},comfirmReturnClick:function(){var e=this;Object(l.e)({orders_id:this.returnCarInfo.orders_id}).then(function(t){e.loadTableData(t,2)})},onModifyCharge:function(e){var t=this;this.$prompt("请输入金额","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/(^[1-9]([0-9]+)?(\.[0-9]{1,2})?$)|(^(0){1}$)|(^[0-9]\.[0-9]([0-9])?$)/,inputErrorMessage:"金额格式不正确"}).then(function(a){var r=a.value;Object(l.r)({orders_id:e.orders_id,charge:r}).then(function(e){t.loadTableData(e,4)})}).catch(function(){console.log("close")})},loadTableData:function(e,t){if(0==e.data.ret){this.rentalDialog=!1,this.returnCarDialog=!1,this._getRental();var a="";1===t?a="添加成功！":2===t?a="还车成功！":3===t?a="删除成功！":4===t&&(a="费用修改成功！"),this.$message({message:a,type:"success"})}else this.$message({message:e.data.msg,type:"error"})},onSizeChange:function(e){this.pageSize=e,this._getRental()},onCurrentChange:function(e){this.pageFlag||(this.pageFlag=!0,this.currentPage=e,this._getRental())},formatCharge:function(e,t,a){switch(a){case 1:return"按里程，"+e.per_unit+"元/公里";case 2:return"按油耗，"+e.per_unit+"元/升";case 3:return"按天数，"+e.per_unit+"元/日";default:return"-"}},formatStatus:function(e,t,a){switch(a){case 1:return"已出租";case 2:return"支付中";case 3:return"已还车";default:return"-"}}},components:{searchBox:a("Rv3D").a}},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"rental main-panel"},[a("searchBox",{attrs:{queryTwo:!0,addBtn:!0,queryDate:!0,exportBtn:!0},on:{onSearch:e.onSearchClick,onAdd:e.onAddRentalClick,onExport:e.onExportClick}}),e._v(" "),a("el-dialog",{attrs:{title:"新增租车",visible:e.rentalDialog,model:"right",width:"30%"},on:{"update:visible":function(t){e.rentalDialog=t},close:e.onCloseRentalDialog}},[a("el-form",{ref:"rentalForm",attrs:{model:e.formData,"label-width":"100px",rules:e.formRule}},[a("el-form-item",{attrs:{label:"手机号",prop:"phone"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.formData.phone,callback:function(t){e.$set(e.formData,"phone",t)},expression:"formData.phone"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"身份证",prop:"identity"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.formData.identity,callback:function(t){e.$set(e.formData,"identity",t)},expression:"formData.identity"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"驾驶证",prop:"licence"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.formData.licence,callback:function(t){e.$set(e.formData,"licence",t)},expression:"formData.licence"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"车牌号",prop:"carId"}},[a("el-select",{attrs:{placeholder:"请选择租用车牌号",filterable:""},on:{change:e.onLoadOriginValByCar},model:{value:e.formData.carId,callback:function(t){e.$set(e.formData,"carId",t)},expression:"formData.carId"}},e._l(e.carOption,function(e){return a("el-option",{key:e.car_id,attrs:{label:e.vehicle_number,value:e.car_id}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"收费方式",prop:"chargeType"}},[a("el-select",{attrs:{placeholder:"请选择收费方式",filterable:""},on:{change:e.onLoadOriginValByType},model:{value:e.formData.chargeType,callback:function(t){e.$set(e.formData,"chargeType",t)},expression:"formData.chargeType"}},e._l(e.chargeOption,function(e){return a("el-option",{key:e.charge_scheme_id,attrs:{label:e.scheme_name,value:e.charge_scheme_id}})}))],1),e._v(" "),e.formData.chargeType&&3!==e.originValType?a("el-form-item",{attrs:{label:1===e.originValType?"起始里程":"起始油耗",prop:"originVal"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.formData.originVal,callback:function(t){e.$set(e.formData,"originVal",t)},expression:"formData.originVal"}}),e._v(" "),a("span",[e._v(e._s(1===e.originValType?"公里":"升"))])],1):e._e(),e._v(" "),e.formData.chargeType&&3===e.originValType?a("el-form-item",{attrs:{label:"起始时间",prop:"originTime"}},[a("el-date-picker",{attrs:{clearable:!1,type:"datetime",format:"yyyy-MM-dd HH:mm:ss","value-format":"timestamp",placeholder:"选择开始时间"},model:{value:e.formData.originTime,callback:function(t){e.$set(e.formData,"originTime",t)},expression:"formData.originTime"}})],1):e._e()],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.rentalDialog=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.onSubmitForm}},[e._v("保 存")])],1)],1),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"element-loading-text":"数据加载中..."}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,"empty-text":e.emptyText,border:"",height:"531"}},[a("el-table-column",{attrs:{prop:"order_number",label:"订单号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"vehicle_number",width:"100",label:"车牌号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"vehicle_brand",label:"车辆品牌"}}),e._v(" "),a("el-table-column",{attrs:{prop:"id_card",label:"身份证号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"driver_card",label:"驾驶证号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"phone_number",width:"100",label:"手机号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"charge_type",formatter:e.formatCharge,label:"收费方式"}}),e._v(" "),a("el-table-column",{attrs:{prop:"charge",width:"100",label:"当前费用"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.charge?t.row.charge+"元":"-"))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"state",width:"80",formatter:e.formatStatus,label:"租凭状态"}}),e._v(" "),a("el-table-column",{attrs:{prop:"start_time",width:"150",label:"开始时间"}}),e._v(" "),a("el-table-column",{attrs:{prop:"end_time",width:"150",label:"结束时间"}}),e._v(" "),a("el-table-column",{attrs:{width:"80",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.state?a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){e.onReturnCarClick(t.row)}}},[e._v("还车")]):e._e(),e._v(" "),2===t.row.state?a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){e.onModifyCharge(t.row)}}},[e._v("修改")]):e._e()]}}])})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"还车",visible:e.returnCarDialog,width:"30%"},on:{"update:visible":function(t){e.returnCarDialog=t}}},[e.returnCarInfo?a("div",[a("p",[e._v("开始租车时间："+e._s(e.returnCarInfo.start_time))]),e._v(" "),a("p",[e._v("结束租车时间："+e._s(e.returnCarInfo.end_time))]),e._v(" "),a("p",[e._v("计费方式："+e._s(e.returnCarInfo.charge_type))]),e._v(" "),a("p",[e._v("收费金额："+e._s(e.returnCarInfo.charge))])]):e._e(),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.returnCarDialog=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.comfirmReturnClick}},[e._v("确 定")])],1)]),e._v(" "),a("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,20,30,40],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.onSizeChange,"current-change":e.onCurrentChange}})],1)},staticRenderFns:[]};var g=a("Z0/y")(c,u,!1,function(e){a("8OPd")},"data-v-7735d5bd",null);t.default=g.exports}});
//# sourceMappingURL=14.c3303af9afca88ee8ae9.js.map